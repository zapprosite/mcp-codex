[[prompts]]
name = "dual-mcp-orchestrator"
description = "Orquestra Trae IDE MCPs + mcp-codex repository"
timeout = "unlimited"

[prompt.context]
discovery_mode = "aggressive"
include_local = true
include_remote = true

content = """
üéØ DUAL MCP ORCHESTRATOR - Codex CLI
Modo: Background Execution | Status: Sempre Ativo
======================================

## FASE 0: DESCOBERTA E SINCRONIZA√á√ÉO

[COMMAND] Listar todos MCPs dispon√≠veis
‚Üí codex mcp list --json --all > /tmp/mcp-manifest.json

[PARSE] Estrutura de MCPs
‚Üí Separar por source: 'trae-ide' vs 'mcp-codex-local'

[VALIDATE] Verificar status de cada MCP
‚Üí Testar conectividade
‚Üí Verificar vari√°veis de ambiente (sem expor secrets)
‚Üí Registrar health status em ~/.codex/mcp-health.json

[SYNC] Se houver diverg√™ncias:
‚Üí Atualizar config.toml
‚Üí Recarregar MCPs
‚Üí Log em ~/.codex/mcp-sync.log

## FASE 1: CONTEXTO UNIFICADO

[MEMORY] Usar MCP "memory" para criar grafo unificado:
  - Nodes: cada MCP dispon√≠vel
  - Edges: depend√™ncias e conflitos
  - Status: healthcheck por MCP
  - Source: trae vs local

[LOG] Registrar:
```
{
  "timestamp": "2025-11-05T00:00:00Z",
  "trae_mcp_count": 6,
  "local_mcp_count": 3,
  "total_active": 9,
  "conflicts": [],
  "missing_secrets": []
}
```

## FASE 2: MONITOR CONT√çNUO (Daemon)

[LOOP] A cada 5 minutos:
  ‚Üí Verificar novos MCPs no reposit√≥rio mcp-codex
  ‚Üí Comparar com √∫ltima snapshot
  ‚Üí Se mudan√ßas: regenerar config.toml
  ‚Üí Executar health check

[ALERTAS]
  - Se MCP falhar: tentativa de restart
  - Se conflito de porta: resolver automaticamente
  - Se secret expirado: notificar via log

## FASE 3: AUTOMA√á√ÉO NOTURNA (Sleep Queue)

‚Üí Executar testes E2E em todos MCPs
‚Üí Gerar relat√≥rio de compatibilidade
‚Üí Sincronizar depend√™ncias (npm/pip)
‚Üí Backup de configura√ß√µes

## FASE 4: RELAT√ìRIO EXECUTIVO

[OUTPUT]
- File: ~/.codex/reports/dual-mcp-status.md
- JSON: ~/.codex/reports/mcp-manifest.json
- Health: ~/.codex/mcp-health.json

---
INICIAR IMEDIATAMENTE
MODO: Background (daemon)
LOG: tail -f ~/.codex/logs/codex.log
"""

[[commands]]
name = "start"
value = "codex daemon:start --profile=dual-mcp-orchestrator"

[[commands]]
name = "monitor"
value = "codex daemon:logs --follow --filter='mcp'"

[[commands]]
name = "health"
value = "cat ~/.codex/mcp-health.json | jq '.'"

[[commands]]
name = "sync"
value = "codex mcp:sync --all --force"

